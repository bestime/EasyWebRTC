{"version":3,"file":"index.js","sources":["../../node_modules/@bestime/utils/dist/release/esm/index.min.js","../../src/EasyWebRTC.ts","../../src/Channel.ts","../../src/Remote.ts","../../src/Room.ts"],"sourcesContent":["/**  \n * 个人工具库 (TS版) bestime.esm.min.js\n * @QQ 1174295440\n * @author Bestime\n * @see https://github.com/bestime/tool\n * @update 2022-11-10 11:11:13\n */\nfunction serverConfig(e){var t,n,o={};for(n in e)t=e[n],o[n]={to:t,reg:new RegExp(\"^(\"+n+\")(/|$)\")};return function(e){var t,n=!1,r=e;for(t in o){var i=o[t];if(i.reg.test(e)){n=!0,\"string\"==typeof i.to&&(r=e.replace(i.reg,i.to+\"$2\"));break}}return n||(console.error('警告：请求地址 \"'+e+'\" 不在白名单中！'),console.table(o)),r}}function isNull(e){return null===e||e===undefined}function _String(e){return isNull(e)?\"\":String(e)}var $letters=[\"A\",\"B\",\"C\",\"D\",\"E\",\"F\",\"G\",\"H\",\"I\",\"J\",\"K\",\"L\",\"M\",\"N\",\"O\",\"P\",\"Q\",\"R\",\"S\",\"T\",\"U\",\"V\",\"W\",\"X\",\"Y\",\"Z\"],$ArrayTypeNameBig=\"Array\",$FunctionTypeNameBig=\"Function\",$ObjectTypeNameBig=\"Object\",$stringTypeNameBig=\"String\",$numberTypeNameBig=\"Number\",$undefinedValue=undefined,$zeroString=\"0\",$falseString=\"false\",$trueString=\"true\",$browserGlobal=window,$ObjectTypeNameBigPrototypeToString=Object.prototype.toString,$encodeURIComponent=encodeURIComponent,$decodeURIComponent=decodeURIComponent,$regSpaceStr=\"\\\\s\\\\uFEFF\\\\xA0\";function getType(e){return $ObjectTypeNameBigPrototypeToString.call(e).slice(8,-1)}function isArray(e){return getType(e)===$ArrayTypeNameBig}function isKvPair(e){return getType(e)===$ObjectTypeNameBig}function hpJsonParse(e,t){var n;try{n=JSON.parse(e)}catch(r){n=t}return n}function KvPair(e){return e=isKvPair(e)||isKvPair(e=hpJsonParse(e))?e:{}}function isFunction(e){return\"function\"==typeof e}function param(e){var n=[];function i(e,t){null!=e&&\"\"!==e&&(t=null==(t=isFunction(t)?t():t)?\"\":t,n[n.length]=$encodeURIComponent(e)+\"=\"+$encodeURIComponent(t))}return function o(e,t){var n,r;if(e)switch(getType(t)){case $ArrayTypeNameBig:for(n=0;n<t.length;n++)o(e+\"[\"+(\"object\"==typeof t[n]&&t[n]?n:\"\")+\"]\",t[n]);break;case $ObjectTypeNameBig:for(r in t)o(e+\"[\"+r+\"]\",t[r]);break;default:i(e,t)}else switch(getType(t)){case $stringTypeNameBig:case $ObjectTypeNameBig:for(r in t)o(r,t[r]);break;case $ArrayTypeNameBig:for(n=0;n<t.length;n++)i(t[n].name,t[n].value)}}(\"\",e),n.join(\"&\")}function urlToGet(e,t){e=_String(e).replace(/&*$/g,\"\").replace(/\\?*$/,\"\");var n=\"\";return(n=isKvPair(t)||isArray(t)?param(t):_String(t).replace(/^&*/,\"\"))&&(e+=(/\\?/.test(e)?\"&\":\"?\")+n),e}var baseReg=\"[\"+$regSpaceStr+\"]+\";function trim(e,t){var n=getType(e),r=(n===$numberTypeNameBig&&(e=String(e),n=$stringTypeNameBig),\"\");if(n!==$stringTypeNameBig)return\"\";switch(t){case 1:r=\"^\"+baseReg;break;case-1:r=baseReg+\"$\";break;case\"*\":r=baseReg;break;default:r=\"^\"+baseReg+\"|\"+baseReg+\"$\"}return e.replace(new RegExp(r,\"g\"),\"\")}function isString(e){return getType(e)===$stringTypeNameBig}function hpIsEmptyMap(e){var t,n=!0;for(t in e)t!==undefined&&(n=!1);return n}function clean(e,t,n){if(n=!1!==n,isKvPair(e)){var r,i,o={};for(i in e)_filterData(isArray(r=e[i])||isKvPair(r)?clean(r,t):r,t,n,function(e){o[i]=e})}else if(isArray(e)){o=[];for(var a=0,u=e.length;a<u;a++)_filterData(clean(e[a],t),t,n,function(e){o.push(e)})}else o=e;return o}function _filterData(e,t,n,r){isString(e)?t&&\"\"==trim(e,\"*\")||r(e):null!=e&&(n&&isKvPair(e)&&hpIsEmptyMap(e),r(e))}function _Array(e){return e=isArray(e)||isArray(e=hpJsonParse(e))?e:[]}function variableHasValue(e,t,n){var r;n=null==n?60:n,e()?t():(clearTimeout(r),setTimeout(function(){variableHasValue(e,t,n)},n))}variableHasValue[\"async\"]=function(t,n){return new Promise(function(e){variableHasValue(t,e,n)})};var _tmp={};function dataCacheUtil(e){_tmp[e]=_tmp[e]||{count:0,complete:!1,data:null};var t=_tmp[e];return t.count++,{isExist:function(){return 1<t.count},set:function(e){t.complete=!0,t.data=JSON.stringify(e)},get:function(e){variableHasValue(function(){return t.complete},function(){e(hpJsonParse(t.data))},100)},logs:_tmp}}function cloneEasy(e){switch(getType(e)){case $ArrayTypeNameBig:for(var t=[],n=0;n<e.length;n++)t.push(cloneEasy(e[n]));break;case $ObjectTypeNameBig:for(var r in t={},e)t[r]=cloneEasy(e[r]);break;case $FunctionTypeNameBig:function i(){e.apply(this,arguments)}for(var o in e.prototype)i.prototype[o]=e.prototype[o];t=i;break;default:t=e}return t}var DEFAULT_CONFIG={id:\"id\",children:\"children\"};function deepFindTreePath(e,t,n){n=Object.assign(DEFAULT_CONFIG,n);for(var r=[],i=cloneEasy(e),o=new Set,a=n[\"children\"];i.length;){var u=i[0];if(o.has(u))r.pop(),i.shift();else if(o.add(u),u[a]&&i.unshift.apply(i,u[a]),r.push(u),t(u))return r}return null}function setObjectToString(e){return e=isString(e)?e:JSON.stringify(e)}function setCookie(e,t,n){t=setObjectToString(t);var r=n&&0<n,i=new Date,n=(r&&i.setTime(i.getTime()+n),e+\"=\"+encodeURI(t)+\";path=/;\");r&&(n+=\"expires=\"+i.toUTCString()),document.cookie=n}function hpTryToParseStringToBasicType(e){return null==e?undefined:$falseString!==e&&($trueString===e||hpJsonParse(e,e))}function getCookie(e,t){t=t||document.cookie;var r=\"\";return t.replace(new RegExp(\"(^|;\\\\s)\"+e+\"=(.*?)($|(;\\\\s))\"),function(e,t,n){r=hpTryToParseStringToBasicType($decodeURIComponent(n))}),r}function removeCookie(e){setCookie(e,\"\",-1)}function _Number(e){return(e=Number(e))===Math.abs(Infinity)||isNaN(e)?0:e}var defaultSplitArr=[$undefinedValue,$undefinedValue];function handleDeepKey(e,t,n){var t=splitSymbol(t),r=t[0];isPreLikeArray(r)?(r=_Number(r),t[1]==$undefinedValue?e.push(n):(/^\\[[\\D]+\\]/.test(t[1])?e[r]=KvPair(e[r]):e[r]=_Array(e[r]),handleDeepKey(e[r],t[1],n))):t[1]==$undefinedValue?e[r]=n:(/^\\[[\\D]+\\]/.test(t[1])?e[r]=KvPair(e[r]):e[r]=_Array(e[r]),handleDeepKey(e[r],t[1],n))}function splitSymbol(e){if(e==$undefinedValue)return defaultSplitArr;var r,i=e;return e.replace(/^\\[(.*?)\\](.*)?/,function(e,t,n){return i=t,r=n,\"\"}),[i,r]}function isPreLikeArray(e){return\"\"===e||/^\\d+$/.test(e)}function parseQuery(e){var o,n,a={};return(e=e||$browserGlobal.location.href).replace(/([^=&?/#]*?)=([^=&?/#]*)/g,function(e,t,i){i=hpTryToParseStringToBasicType($decodeURIComponent(i)),n=$decodeURIComponent(t),o=!1,\"\"!==n&&(n.replace(/(.*?)(\\[.*)/,function(e,t,n){var r=splitSymbol(n);o=!0,isPreLikeArray(r[0])?a[t]=_Array(a[t]):a[t]=KvPair(a[t]),handleDeepKey(a[t],n,i)}),o||(a[n]=i))}),a}function defaultValue(e,t){return isNull(e)?t:e}function downloadFileByUrl(e,t){var n=document.createElement(\"a\");n.download=t,n.setAttribute(\"href\",e),n.setAttribute(\"download\",t),document.body.appendChild(n)}var iUrl=$browserGlobal.URL;function downloadFileByArrayBuffer(e,t){e=iUrl.createObjectURL(new Blob([e]));downloadFileByUrl(e,t),iUrl.revokeObjectURL(e),undefined}function repeatString(e,t){var n=\"\";if((e=_String(e)).length*t<1<<28)for(;1==(1&t)&&(n+=e),0!=(t>>>=1);)e+=e;return n}function hpPadString(e,t,n,r){return(e=_String(e)).length>(t>>=0)?e:(t-=e.length,n.length<t&&(n+=repeatString(n,t/n.length)),-1===r?n.slice(0,t)+e:e+n.slice(0,t))}function padStart(e,t,n){return hpPadString(e,t,n,-1)}function padEnd(e,t,n){return hpPadString(e,t,n,1)}function split(e,t){return\"\"!==e?e.split(t):[]}function floorFixed(e,t,n){var e=split(e=trim(_Number(e)),\".\"),r=e[1]||\"\";return r.length<t&&(r=padEnd(r,t,$zeroString),n&&(r=r.replace(/0+$/,\"\"))),t<1||!r?e[0]:e[0]+\".\"+r.substring(0,t)}function roundFixed(e,t,n){e=_Number(e);var r,i=Math.pow(10,t),e=_String(Math.round(e*i)/i);return 0<t&&(r=(i=split(e,\".\"))[0],(i=i[1]||\"\").length<t&&(i=padEnd(i,t,$zeroString),e=(i=n?i.replace(/0+$/,\"\"):i)?r+\".\"+i:r)),e}function deepFindItem(e,n,r){var i,o;return r=isNull(r)?\"children\":r,function a(e){if(e)for(var t=0;t<e.length;t++){if(o=n(e[t])){i=e[t];break}if(a(e[t][r]),o)break}}(e),i}function flatArrayToTree(e,t){for(var n,r,i=(t=KvPair(t)).id||\"id\",o=t.pid||\"pid\",a=t.children||\"children\",u=0;u<e.length;u++)(r=e[u])[a]=_Array(r[a]),(n=deepFindItem(e,function(e){return null!=e[i]&&e[i]!=r[i]&&e[i]===r[o]},a))&&(n[a]=_Array(n[a]),n[a].push(r),e.splice(u--,1));return e}function changeIndex(e,t,n){e+=1;return(t=(t+n)%e)<0&&(t+=e),-0===t?0:t}function zeroTo2(e){return padStart(e,2,\"0\")}function formatFunc(e,t,n){var r=e[t];return e[t]===undefined||null===e[t]?\"\":zeroTo2(n)+r}function handleOne(e,t){for(var n=e.split[0],r=t.split[1],i=0;i<n.length&&n[i]===r[i];i++)r[i]=\"\"}function timeLine(e,t){t=t||[\"年\",\"月\",\"日 \",\"时\",\"分\",\"秒\",\"毫秒\"];for(var n,r=[],i=0;i<e.length;i++){var o,a=[formatFunc(t,0,(o=new Date(e[i])).getFullYear()),formatFunc(t,1,o.getMonth()+1),formatFunc(t,2,o.getDate()),formatFunc(t,3,o.getHours()),formatFunc(t,4,o.getMinutes()),formatFunc(t,5,o.getSeconds()),formatFunc(t,6,o.getMilliseconds())];r.push({value:e[i],timestamp:+o,split:[a,cloneEasy(a)]})}r.sort(function(e,t){return e.millisecond-t.millisecond});for(i=1;i<r.length;i++)handleOne(r[i-1],r[i]);for(i=0;i<r.length;i++)(n=r[i]).split=n.split[1],n.label=trim(n.split.join(\"\"));return r}var Bytes=8,KB=1024*Bytes,MB=1024*KB,GB=1024*MB,TB=1024*GB,minUnit=.1;function fileSize(e,t){var n=e;switch(t=t||\"Bytes\"){case\"MB\":n=e*MB;break;case\"KB\":n=e*KB;break;case\"Bytes\":n=e*Bytes}var t=n/TB,r=n/GB,i=n/MB,o=n/KB,a=(console.log(\"_kb\",o),n/Bytes),t=floorFixed(t.toFixed(8),2),r=floorFixed(r.toFixed(8),2),i=floorFixed(i.toFixed(8),2),o=floorFixed(o.toFixed(8),2);return{Bit:n,Bytes:a=floorFixed(a.toFixed(8),2),KB:o,MB:i,GB:r,TB:t,format:minUnit<+t?t+\" TB\":minUnit<+r?r+\" GB\":minUnit<+i?i+\" MB\":o+\" KB\"}}function removeElement(e){e.parentNode&&e.parentNode.removeChild(e)}function prevent(e,t,n){e=e||$browserGlobal.event,n=!1!==n,(t=!1!==t)&&$browserGlobal.event?$browserGlobal.event.cancelBubble=!0:e.stopPropagation(),n&&$browserGlobal.event?$browserGlobal.event.returnValue=!1:e.preventDefault()}function getRandom(e,t,n){n=!1===n?0:1;return e=Math.random()*(t-e+n)+e,n?Math.floor(e):e}function getRandomWord(){return $letters[getRandom(0,$letters.length-1)][0]}function uuid(e){e=_Number(e);for(var t=\"\",n=0;n<13;n++)t+=getRandom(1,9);e=(new Date).getTime()*getRandom(1,100);return padEnd(getRandomWord()+Number(t).toString(32)+e.toString(32),20,getRandomWord()+getRandomWord()+getRandomWord())}function _Boolean(e){return!0===e||\"true\"===e||\"1\"===e||1===e}function getStorage(e){e=localStorage.getItem(e);return e?hpTryToParseStringToBasicType(e):\"\"}function removeStorage(e){localStorage.removeItem(e)}function hpSetStringValue(e){return e=isString(e)?e:JSON.stringify(e)}function setStorage(e,t){localStorage.setItem(e,hpSetStringValue(t))}function getRelativePos(e){var t=e.getBoundingClientRect();return{x:t.left,y:t.top,height:e.offsetHeight,width:e.offsetWidth,clientWidth:e.clientWidth,clientHeight:e.clientHeight}}function flatTree(e,r){var i=[];return r=defaultValue(r,\"children\"),function o(e){if(isArray(e))for(var t,n=0;n<e.length;n++)t=e[n],i.push(t),o(t[r])}(e),i}function getJsFileBaseUrl(e){e=e||0;for(var t=\"/[^/]*\",n=document.scripts,r=0;r<e;r++)t+=t;return n[n.length-1].src.replace(new RegExp(t+\"$\"),\"\")}function getfile(e,t,n,r,i){var o;\"script\"===n?(o=document.createElement(\"script\")).src=r:((o=document.createElement(\"link\")).href=r,o.setAttribute(\"rel\",\"stylesheet\")),o.setAttribute(\"level-id\",e),o.setAttribute(\"author\",\"bestime\"),o.onload=o.onerror=i,t.appendChild(o)}function defaultCallback(){}var _setting={},times=0,oHead=document.getElementsByTagName(\"head\")[0];function getMuti(e,n,r,i){for(var o=[],a=0,t=0;t<r.length;t++)!function(t){getOne(e,n,r[t],function(e){o[t]=e,++a===r.length&&i.apply($undefinedValue,o)})}(t)}function getOne(e,t,n,r){var i=_setting&&_setting[n];if(!i)throw'alias \"'+n+'\" is not configured';var o=/^js/.test(n);function a(){i&&(i._complete=!0,isFunction(r)&&(o?r(i.moduleName?$browserGlobal[i.moduleName]:undefined):r()))}i._count&&0<i._count?variableHasValue(function(){return i._complete},a):!i._depenIsLoad&&i.dependencies&&0<i.dependencies.length?(i._depenIsLoad=!0,getMuti(e,t+1,i.dependencies,function(){getOne(e,t,n,a)})):!i._withIsLoad&&i[\"with\"]&&0<i[\"with\"].length?(i._withIsLoad=!0,getMuti(e,t,i[\"with\"].concat(n),a)):(i._count=i._count?i._count+1:1,i._deeps=e+\".\"+t,getfile(i._deeps,oHead,o?\"script\":\"link\",i.url,a))}function loadJsAndCss(e,t){(\"object\"==typeof e?getMuti:getOne)(++times,1,e,t=t||defaultCallback)}loadJsAndCss.config=function(e){if(!hpIsEmptyMap(_setting))throw\"config is already configured\";_setting=e},loadJsAndCss.getConfig=function(){return _setting},loadJsAndCss[\"async\"]=function(t){return new Promise(function(e){loadJsAndCss(t,function(){isArray(t)?e(arguments):e(arguments[0])})})};var main$2=function(e,t,n,r){r=r||500;var i=[0,0,!1],o=[0,0,!1],a=setInterval(function(){e.isConnected?(i[0]=e.offsetWidth,o[0]=e.offsetHeight,i[2]=i[0]!==i[1],o[2]=o[0]!==o[1],i[2]&&(i[1]=i[0],\"width\"===n&&t(e)),o[2]&&(o[1]=o[0],\"height\"===n&&t(e)),n||(i[2]||o[2])&&t(e)):u()},r);function u(){clearInterval(a)}return u},main$1=function(e,r,i,o){o=o||\"children\";var t=[];return function a(e,t){for(var n=0;n<e.length;n++)t[n]=cloneEasy(i(e[n])),t[n][r]=[],e[n][o]&&a(e[n][o],t[n][r])}(e,t),t},events={};function defineEventBus(i){if(events[i])throw'\"'+i+'\" Has already been registered!';return events[i]=events[i]||[],{on:function(e){events[i].push(e)},emit:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0;r<events[i].length;r++)events[i][r].apply($undefinedValue,t)},off:function(e){if(!e)throw\"the hander of off is required!\";for(var t=0;t<events[i].length;t++)events[i][t]===e&&events[i].splice(t--,1)},dispose:function(){for(var e=0;e<events[i].length;e++)events[i].splice(e--,1);delete events[i]}}}var main=function(e,n,r){r=r||\"children\",function i(e){for(var t=0;t<e.length;t++)n(e[t]),isArray(e[t][r])&&i(e[t][r])}(e)};export{_Array,_Boolean,KvPair as _KvPair,_Number,_String,changeIndex,clean,cloneEasy,dataCacheUtil,deepFindItem,deepFindTreePath,defaultValue,defineEventBus,downloadFileByArrayBuffer,downloadFileByUrl,fileSize,flatTree,floorFixed,main as forEachTree,getCookie,getJsFileBaseUrl,getRandom,getRelativePos,getStorage,getType,isArray,isFunction,isKvPair,isNull,main$1 as mapTree,loadJsAndCss as need,main$2 as observeDomResize,padEnd,padStart,param,parseQuery,prevent,removeCookie,removeElement,removeStorage,repeatString,roundFixed,serverConfig,setCookie,setStorage,split,timeLine,flatArrayToTree as tree,trim,urlToGet,uuid,variableHasValue};\n","import { defineEventBus } from \"@bestime/utils\";\ntype Message = string | ArrayBuffer\n\nexport const eReadyBus = defineEventBus('ready')\nexport const eMessageBus = defineEventBus<(data: Message) => void>('on-message')\n\nexport default class EasyWebRTC {\n  _cfg: EasyWebRTC.BaseConfig;\n  _connection: RTCPeerConnection;\n  _channel: RTCDataChannel\n\n  constructor(config: EasyWebRTC.BaseConfig) {\n    this._cfg = config;\n    this._connection = new RTCPeerConnection({\n      iceServers: [{ urls: this._cfg.server }]\n    });\n\n    this._channel = this._connection.createDataChannel('testChannel', {\n      negotiated: true,\n      id: 0\n    });\n\n    this._channel.onmessage = (ev) => {\n      eMessageBus.emit(ev.data)\n    }\n\n    this._channel.onopen = (e) => {\n      console.log('连接上了');\n      eReadyBus.emit()      \n    };\n  }\n\n\n  sendMessage (data: Message) {\n    this._channel.send(data as any)\n  }\n\n  off (name: string, handler:any) {\n    switch(name) {\n      case 'ready':\n        eReadyBus.off(handler)\n        break;\n      case 'message':\n        eMessageBus.off(handler)\n        break;\n    }\n  }\n\n  on(name: 'ready' | 'message', handler: any) {\n    switch(name) {\n      case 'ready':\n        eReadyBus.on(handler)\n        break;\n      case 'message':\n        eMessageBus.on(handler)\n        break;\n    }\n    \n  }\n\n}\n","import EasyWebRTC, { eMessageBus } from './EasyWebRTC'\n\nexport default class Channel extends EasyWebRTC {\n  \n  constructor (config: EasyWebRTC.BaseConfig) {\n    super(config)\n    this.init()\n\n\n    \n  }\n\n  init () {\n    \n\n\n    \n    this._connection.addEventListener('icecandidate', function (event) {\n      \n      const iceCandidate = event.candidate;\n  \n      if (iceCandidate) {\n        const newIce = new RTCIceCandidate(iceCandidate);\n        const ice = JSON.stringify(newIce)\n        console.log('通知对端添加 ice =>',ice);\n      }\n    });\n\n    this._connection.createOffer().then((description) => {\n      this._connection.setLocalDescription(description);\n      \n      console.log('通知对端设置：description => ', JSON.stringify(description))\n    })\n  }\n\n  \n\n  updateDescription (description: string) {\n    const desc: RTCSessionDescriptionInit = JSON.parse(description)\n    this._connection.setRemoteDescription(desc);\n  }\n}","import EasyWebRTC, { eReadyBus } from './EasyWebRTC'\n\nexport default class Remote {\n  \n  _cfg: EasyWebRTC.BaseConfig;\n  _connection: RTCPeerConnection;\n  _channel: RTCDataChannel;\n\n  constructor (config: EasyWebRTC.BaseConfig) {\n    this._cfg = config;\n    this._connection = new RTCPeerConnection({\n      iceServers: [{ urls: this._cfg.server }]\n    });\n\n    this._channel = this._connection.createDataChannel('testChannel', {\n      negotiated: true,\n      id: 0\n    });\n\n    this._channel.onmessage = (ev) => {\n      this.onmessage(ev.data)\n    }\n\n    this._channel.onopen = (e) => {\n      this.onconnect()      \n    };\n    \n  }\n\n  onmessage (data: any) {}\n  onconnect () {}\n  send (data: any) {\n    this._channel.send(data)\n  }\n\n  setSecret (description: string, ice: string) {\n    \n\n    const desc: RTCSessionDescriptionInit = JSON.parse(description)\n    const ICE: RTCIceCandidateInit = JSON.parse(ice)\n\n    this._connection.setRemoteDescription(desc);\n    this._connection.addIceCandidate(ICE)\n    this._connection.createAnswer().then((channelDesc) => {\n      this._connection.setLocalDescription(channelDesc);\n      console.log('通知各个频道更新channelDesc => ', JSON.stringify(channelDesc))\n    });\n  }\n}","import { eMessageBus } from \"./EasyWebRTC\";\nimport Remote from \"./Remote\";\n\n\n\nexport default class Room {\n  _cfg: EasyWebRTC.BaseConfig;\n  _rooms: Remote[] = []\n  constructor (config: EasyWebRTC.BaseConfig) {\n    this._cfg = config\n  }\n\n  onmessage (data: any) {}\n\n  join (description: string, ice: string) {\n    const iRoom = new Remote(this._cfg)\n    iRoom.setSecret(description, ice)\n    this._rooms.push(iRoom)\n    iRoom.onmessage = (data) => {\n      this.onmessage(data)\n    }\n    iRoom.onconnect = () => {\n      iRoom.send('我加入了')\n    }\n  }\n\n  sendMessage (msg: string) {\n    console.log(\"发送消息\", this._rooms)\n    this._rooms.forEach(function (iRoom) {\n      iRoom.send(msg)\n    })\n  }\n}"],"names":[],"mappings":"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"}